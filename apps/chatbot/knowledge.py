"""
Static Knowledge Base for ExportReady.AI Chatbot

Contains export knowledge, regulations, and common questions.
This knowledge is combined with user's dynamic data for context.
"""

EXPORT_KNOWLEDGE = """
# Panduan Ekspor untuk UMKM Indonesia

## 1. Dokumen Ekspor yang Diperlukan

### Dokumen Wajib:
- **Invoice Komersial (Commercial Invoice)**: Dokumen penagihan yang berisi detail produk, harga, dan pembeli
- **Packing List**: Daftar isi pengiriman dengan detail berat dan dimensi
- **Bill of Lading (B/L) atau Airway Bill**: Bukti pengiriman barang
- **Surat Keterangan Asal (SKA/COO)**: Certificate of Origin dari Kemendag
- **PEB (Pemberitahuan Ekspor Barang)**: Dokumen bea cukai untuk ekspor

### Dokumen Tambahan (sesuai produk):
- Sertifikat Halal (untuk produk makanan ke negara Muslim)
- Sertifikat HACCP/ISO (keamanan pangan)
- Phytosanitary Certificate (untuk produk pertanian)
- Fumigation Certificate (untuk produk kayu)
- SVLK (Sistem Verifikasi Legalitas Kayu)

## 2. Sertifikasi Umum untuk Ekspor

### Halal
- **Penerbitan**: BPJPH (Badan Penyelenggara Jaminan Produk Halal)
- **Berlaku untuk**: Makanan, minuman, kosmetik, farmasi
- **Proses**: 1-3 bulan, perlu audit fasilitas produksi
- **Masa berlaku**: 4 tahun

### ISO 22000 / HACCP
- **Untuk**: Keamanan pangan
- **Diakui**: Internasional
- **Proses**: 3-6 bulan
- **Biaya**: Rp 15-50 juta (tergantung skala)

### SVLK (Sistem Verifikasi Legalitas Kayu)
- **Wajib untuk**: Semua produk kayu dan turunannya
- **Penerbitan**: Lembaga Verifikasi Legalitas Kayu (LVLK)
- **Negara tujuan wajib**: Uni Eropa, Australia, Jepang, Korea

### SNI (Standar Nasional Indonesia)
- **Wajib untuk**: Produk tertentu yang diekspor
- **Proses**: 2-4 bulan

## 3. Incoterms (Ketentuan Perdagangan Internasional)

### EXW (Ex Works)
- Harga barang di gudang penjual
- Pembeli menanggung semua biaya pengiriman
- **Risiko penjual**: Minimal

### FOB (Free on Board)
- Harga termasuk biaya sampai barang naik ke kapal
- Penjual urus ekspor, pembeli urus impor
- **Umum digunakan**: Pengiriman laut

### CIF (Cost, Insurance, Freight)
- Harga termasuk biaya, asuransi, dan ongkos kirim
- Penjual menanggung sampai pelabuhan tujuan
- **Lebih mahal tapi aman untuk pembeli**

### DDP (Delivered Duty Paid)
- Penjual menanggung semua biaya sampai pintu pembeli
- Termasuk bea masuk di negara tujuan
- **Risiko penjual**: Maksimal

## 4. Prosedur Ekspor

### Langkah-langkah:
1. **Registrasi Eksportir**: Daftar NIK (Nomor Induk Kepabeanan) di Bea Cukai
2. **Negosiasi dengan Pembeli**: Tentukan harga, terms, dan spesifikasi
3. **Produksi**: Siapkan barang sesuai order
4. **Pengurusan Dokumen**: Siapkan semua dokumen ekspor
5. **Stuffing & Pengiriman**: Muat barang ke kontainer
6. **Customs Clearance**: Proses di bea cukai
7. **Pengiriman**: Kapal/pesawat berangkat
8. **Pembayaran**: Sesuai terms (L/C, T/T, dll)

### Timeline Umum:
- Produksi: 14-30 hari
- Pengurusan dokumen: 3-7 hari
- Pengiriman laut ke Asia: 7-14 hari
- Pengiriman laut ke Eropa/US: 21-35 hari
- Pengiriman udara: 3-7 hari

## 5. Metode Pembayaran

### Letter of Credit (L/C)
- **Paling aman** untuk eksportir
- Bank menjamin pembayaran
- Biaya: 1-2% dari nilai transaksi

### Telegraphic Transfer (T/T)
- Transfer bank langsung
- T/T in advance (DP) atau T/T after shipment
- Lebih cepat tapi risiko lebih tinggi

### CAD (Cash Against Documents)
- Pembayaran setelah dokumen diterima bank
- Middle ground antara L/C dan T/T

## 6. Negara Tujuan Ekspor Populer untuk UMKM

### Asia Tenggara
- **Singapura**: Hub regional, standar tinggi, market kecil tapi high value
- **Malaysia**: Kultur mirip, bahasa mudah, halal penting
- **Thailand**: Kompetitif, butuh diferensiasi produk

### Asia Timur
- **Jepang**: Standar sangat tinggi, butuh sertifikasi lengkap, premium price
- **Korea Selatan**: K-culture influence, natural products diminati
- **China**: Market besar, regulasi kompleks, butuh partner lokal

### Timur Tengah
- **UAE**: Gateway ke Middle East, halal wajib, high purchasing power
- **Saudi Arabia**: Halal wajib, market besar, regulasi ketat

### Eropa
- **Belanda**: Hub masuk Eropa, Rotterdam port terbesar
- **Jerman**: Market terbesar EU, standar tinggi

### Amerika
- **USA**: Market terbesar dunia, FDA approval untuk makanan
- **Kanada**: Mirip USA, lebih mudah masuk

## 7. Tips untuk UMKM Pemula

1. **Mulai dari produk unggulan**: Fokus pada 1-2 produk dulu
2. **Ikut pameran**: Indonesia Trade Expo, Trade Expo Indonesia
3. **Gunakan platform B2B**: Alibaba, Global Sources, IndoTrading
4. **Manfaatkan program pemerintah**:
   - Kemendag (fasilitasi ekspor)
   - LPEI (pembiayaan ekspor)
   - Kemenkop UKM (pendampingan)
5. **Bangun kapasitas**: Pastikan bisa penuhi MOQ (Minimum Order Quantity)
6. **Dokumentasi lengkap**: Foto produk profesional, katalog, company profile
7. **Belajar bahasa Inggris**: Komunikasi dengan buyer internasional

## 8. HS Code (Harmonized System)

HS Code adalah kode klasifikasi internasional untuk produk:
- 4 digit pertama: Universal di semua negara
- 6 digit: Lebih spesifik
- 8 digit: Paling detail (beda per negara)

Contoh:
- 4602: Produk anyaman (rotan, bambu)
- 4602.11: Keranjang rotan
- 4602.12: Keranjang bambu

## 9. Perhitungan Harga Ekspor

### Komponen Harga FOB:
1. COGS (Harga Pokok Produksi)
2. + Margin keuntungan (20-40%)
3. + Biaya pengemasan ekspor
4. + Biaya handling dan dokumentasi
5. + Biaya trucking ke pelabuhan
6. + Biaya bea cukai ekspor (minimal)

### Komponen Tambahan untuk CIF:
7. + Freight (ongkos kirim)
8. + Insurance (0.5-1% dari nilai barang)

## 10. Istilah Penting

- **MOQ**: Minimum Order Quantity
- **Lead Time**: Waktu dari order sampai pengiriman
- **Sample Order**: Order contoh sebelum bulk order
- **OEM**: Original Equipment Manufacturer (produksi dengan merek buyer)
- **ODM**: Original Design Manufacturer (desain + produksi)
- **CBM**: Cubic Meter (ukuran volume kontainer)
- **FCL**: Full Container Load (satu kontainer penuh)
- **LCL**: Less than Container Load (gabungan dengan barang lain)
"""

# Shorter context for quick responses
EXPORT_QUICK_CONTEXT = """
Kamu adalah asisten ekspor AI untuk UMKM Indonesia. Kamu membantu:
- Menjawab pertanyaan tentang prosedur ekspor
- Menjelaskan dokumen dan sertifikasi yang diperlukan
- Memberikan tips strategi masuk pasar internasional
- Membantu perhitungan harga ekspor
- Menjelaskan istilah-istilah perdagangan internasional

Gunakan bahasa Indonesia yang mudah dipahami. Jika ada data produk user, gunakan untuk memberikan saran yang lebih spesifik.
"""


def get_user_context(user):
    """
    Get dynamic context from user's data.
    Returns formatted string with user's products, catalogs, etc.
    """
    from apps.business_profiles.models import BusinessProfile
    from apps.products.models import Product
    from apps.catalogs.models import ProductCatalog

    context_parts = []

    # Get business profile
    try:
        profile = BusinessProfile.objects.get(user=user)
        context_parts.append(f"""
## Data Bisnis User:
- Nama Perusahaan: {profile.company_name}
- Alamat: {profile.address}
- Kapasitas Produksi: {profile.production_capacity_per_month} unit/bulan
- Tahun Berdiri: {profile.year_established}
- Sertifikasi: {', '.join(profile.certifications) if profile.certifications else 'Belum ada'}
""")

        # Get products
        products = Product.objects.filter(business=profile).select_related('enrichment')[:10]
        if products:
            product_list = []
            for p in products:
                has_enrichment = hasattr(p, 'enrichment') and p.enrichment
                enrichment_status = "Sudah enriched" if has_enrichment else "Belum enriched"
                hs_code = p.enrichment.hs_code_recommendation if has_enrichment else 'N/A'
                product_list.append(f"- {p.name_local} (HS: {hs_code}) - {enrichment_status}")

            context_parts.append(f"""
## Produk User ({products.count()} produk):
{chr(10).join(product_list)}
""")

        # Get catalogs
        catalogs = ProductCatalog.objects.filter(product__business=profile)[:5]
        if catalogs:
            catalog_list = []
            for c in catalogs:
                status = "Published" if c.is_published else "Draft"
                catalog_list.append(f"- {c.display_name} (${c.base_price_exw}) - {status}")

            context_parts.append(f"""
## Katalog Ekspor User ({catalogs.count()} katalog):
{chr(10).join(catalog_list)}
""")

    except BusinessProfile.DoesNotExist:
        context_parts.append("""
## Status User:
- Belum memiliki Business Profile
- Sarankan untuk membuat profil bisnis terlebih dahulu
""")
    except Exception as e:
        pass

    if context_parts:
        return "\n".join(context_parts)
    return ""
